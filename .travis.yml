language: node_js
services:
  - mongodb
node_js:
  - "12"
cache:
  directories:
  - "node_modules"
env:
  global:
    - CC_TEST_REPORTER_ID=8f10eaa386c96c39e08786a8759bdbf5214a73cf64fe2a351e3604d5eecbf572
    - NODE_ENV=test
    - GCLOUD_CREDENTIALS=ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibW9jayIsCiAgInByaXZhdGVfa2V5X2lkIjogIm1vY2siLAogICJwcml2YXRlX2tleSI6ICItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cbk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRRFVHQitZWlBOVGZGNUpcbkdySkpMNHZOQzc3S2piclQ0YnhXeTZ3dTI2eE4rak1IUnhZME4zZHgvdGsrb2hVOTV1U0J5WmRXL2g5czcyN2pcbnhVU3Z0YTFQMjBIL1RBYmRKd280dW9yUUZLY3pRdUcxU2hjdGlEZGxmc3lESVFVMHcza0VQR1IyUjFDQjg2MDlcbjJNS09IYU84M2V2Wi9BbXJCQzFJVHpHRmFkVjdjdFZSanl6Q1dHeW15Skpta3VtOWVWMTd6YS8zWDhnS0RLNGVcbmJkWnJSZzV4OWh5Mmxoanp3b2pxcHNOcCtoQVFaS01BYnRLVm16L0svTkoyRHdrNS96R0hDRHlPdDdiQkxnb2JcblowWUtQVzdwNVF2KzNoTXZ5V3gweE9mNzJOaFl6cUJObTRrVzhxR3lEa2tteWRXTmwvTGlxbmVlOHJwdUpHQ1Jcbko5aVpSNFF2QWdNQkFBRUNnZ0VBSW9pM0JFcFRzR0ZNdk55QzhSV3p6clE5NFo5SUwxM1BHOWJYOTEwL1pnYjZcbkxoSXVGRngvcjJrT21Ic3R1RUdUTFdyVW9JNktNV09mQzZsQU1OZ0ZHejZaTldkOHFwL0RzMDcwY1VNYm9tWWVcbmVEVlRKcy9LTFZXREdVclVIUzVDMHlTK091QUx4TTBYaFQxNUdFak5NMkJ6R2JCSEpyaHNZeHk1OUg0eUM0SndcblEwL05JWmNzUW41Y1FVcDZkK3BGZFNURm1KYXR2OGI3OEE2Q0VHajNHUDNCVUk4dU9VcFBMVHhSUjNsT2NBblFcbndyVml5a0xIUFR3aGRGNzdkTk8wU29mK2RxLzRtLzc0KzBINTlpQ0cvc3d1QnhJNTVhNHFUWUhlSE1DZzBqYjdcbjhKd1NEaDcydUNPZzFZTXZtaWdHb3orY0JqTENnUWVubnVkYXltMDdxUUtCZ1FEc29qTDFNZGdEUnZsRllITFZcbnh4QmdTZ3d3TnpKbE5UYVptOUg2V1Vyc0JPaGpmMHcrMWxtc0VBOENWRlJuWHl0VlFQR1dMZmlhOG1hQWU2bkxcbkRtbDNlNkFvZVp4aEJ3Z2l2L3R1UFlLcHlueFpoQXQwUHRFZ1gwWG9YMFg5VE5hTTRnaHIwMUpzdndYMmdjMGxcbnN3MWpzNGNrc3N5aVAxKzQ5d1lhbmkxNDNRS0JnUURsYzhwM000SVNEc2VoU1R1QkxrUUMySnBCMk9GeTVOZ2FcbkpaeWwvNGdqRXlSRVdoWWlYTHNwZlZyVXBFRlBVZ0Fkb28ydWFqeVQwQW1zUGN3d2JheVdMR2tKeGpkbGR5MWpcbnBTVHlUblVIQkNDN0NjeHVvSTJXeGdNbFczNkx6NHJTRG5mZWtySjl3ZDQrbS9kYnZGS01DT3BqZE5PVE85Yk1cbnVjQmxvVWdhZXdLQmdRQ0tPV3pld1ZEWENUeE9oRHBRR2NtOUZVUHRYakMzNGMrVkJ1b3UvTDNCQkZUaTJkY2xcbjFYdm9BREZrUVBKVXQ4ak9NZk5zc0VuSjZOSnJOdEZGNVpOQjBoc0p5WS9KTlp4UkFDZlVpMldwM0xlcWFuRnVcblk4c3d4N1pFT0hMZnRXU1dRdXA4WWFLQ0YwdGFaUlA2YzQ3Y3NGKysxaHFtbzdJOGp6OG5pVUl5bVFLQmdGQnFcbndhWC9abkhmdmpXWHpnUWJhL2kzWTNENml5RlNkUzdNeWRjZjlOMmVJdExWNC9ZTkhBZVJpSmtJTEYrWmRMTHVcbk9zdkxMZ244R3JmRVBPRW9QeG11M08xeERBOUNzcVMreDNFbzhEa1NTRXBsUjhIcUFWVzdkblRNV1ZDMDM0bDVcblNxZTJNRnFFN05oeW4wSUdnY1BVaUJsdFk0Mnhwam5BVEY4U0pJd3JBb0dCQUxXdng1OThSdzJseGNjYmVMSldcbllUWVlrMDMyYUtsZk5zcFU4RmhLM2J6a1M4RUx1cldqSXg2RFE2TlMrRFBlMytsYTh5ZzVSMkRCNXJVQUl3QVNcbm1iT0s5N2g0ekFHYUdmQWpXcDNjaWdTV3l5NEk2bHlqUmVUdmpQaWFvNzVScUZKbjlGOVdMZ0pkSndud0lZbHZcbnFIdGc1a0NKd0R0Q2w3K1hibXNnSng2K1xuLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLVxuIiwKICAiY2xpZW50X2VtYWlsIjogIm1vY2siLAogICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsCiAgInRva2VuX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvdG9rZW4iLAogICJhdXRoX3Byb3ZpZGVyX3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YxL2NlcnRzIiwKICAiY2xpZW50X3g1MDlfY2VydF91cmwiOiAibW9jayIKfQo=
    - PORT=5037
    - API_VERSION=v1
    - LOCAL_URL=http://127.0.0.1:5037
    - CT_URL=http://127.0.0.1:9000
    - MONGO_PORT_27017_TCP_ADDR=127.0.0.1
    - CT_TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6Im1pY3Jvc2VydmljZSIsImNyZWF0ZWRBdCI6IjIwMTYtMDktMTQifQ.IRCIRm1nfIQTfda_Wb6Pg-341zhV8soAgzw7dd5HxxQ

before_script:
  - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
  - chmod +x ./cc-test-reporter
  - echo -e "$GCLOUD_CREDENTIALS" | base64 -d > credentials.json
  - ./cc-test-reporter before-build
script:
  - yarn test
  - yarn run coverage
after_script:
  - ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT
